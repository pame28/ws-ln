using System;
using System.Collections.Generic;
using System.IO;
using System.Web.Hosting;
using Newtonsoft.Json;

namespace wsListasNegras.respuestaAutomatica
{
    public static class RespuestasAutomaticasConfig
    {
        // Ruta física al JSON
        public static string JsonPath => HostingEnvironment.MapPath("~/respuestaAutomatica/RespuestasAutomaticas.json");

        // Leer JSON siempre fresco
        public static List<EscenarioRespuesta> GetEscenarios()
        {
            string path = JsonPath;

            if (!File.Exists(path))
                throw new FileNotFoundException("No se encontró el archivo JSON en: " + path);

            string json;
            using (var fs = new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
            using (var sr = new StreamReader(fs))
            {
                json = sr.ReadToEnd();
            }

            var escenarios = JsonConvert.DeserializeObject<List<EscenarioRespuesta>>(json)
                             ?? new List<EscenarioRespuesta>();

            return escenarios;
        }
    }
}
