public DataTable EnvioTransaccion(
    string usuario,
    string pass,
    string tramaIdentidad,
    string tramaPrimerNombre,
    string tramaSegundoNombre,
    string tramaPrimerApellido,
    string tramaSegundoApellido,
    string tramaRazonSocial,
    string tramaTipoPersona,
    string tramaNacionalidad,
    string tramaFechaNacimiento,
    string tramaGrupoLista
)
{
    DataTable dtErrores = new DataTable();
    dtErrores.Columns.Add("Codigo");
    dtErrores.Columns.Add("Descripcion");

    try
    {
        // Validaci칩n de credenciales
        if (!CredencialesValidas(usuario, pass))
        {
            dtErrores.Rows.Add(1);
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E000";
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "Credenciales no v치lidas!";
            return dtErrores;
        }

        // 游댳 INICIO CAMBIO: Flag temporal para manejar caso de proveedor
        bool copiarRazonSocialAPrimerNombre = true;
        // 游댳 FIN CAMBIO


        // 游댳 INICIO CAMBIO: Validaciones de campos de entrada seg칰n tipo de persona

        // Validaciones globales
        if (string.IsNullOrWhiteSpace(tramaIdentidad))
        {
            dtErrores.Rows.Add(1);
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E001";
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Identidad' no puede estar vac칤o.";
        }

        if (string.IsNullOrWhiteSpace(tramaNacionalidad))
        {
            dtErrores.Rows.Add(1);
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E002";
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Nacionalidad' no puede estar vac칤o.";
        }

        if (string.IsNullOrWhiteSpace(tramaFechaNacimiento))
        {
            dtErrores.Rows.Add(1);
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E003";
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Fecha de Nacimiento' no puede estar vac칤o.";
        }

        if (string.IsNullOrWhiteSpace(tramaGrupoLista))
        {
            dtErrores.Rows.Add(1);
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E004";
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Grupo Lista' no puede estar vac칤o.";
        }


        // Validaciones espec칤ficas por tipo de persona
        if (tramaTipoPersona.ToUpper() == "N")
        {
            if (string.IsNullOrWhiteSpace(tramaPrimerNombre))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E005";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Primer Nombre' es obligatorio para personas naturales.";
            }

            if (string.IsNullOrWhiteSpace(tramaSegundoNombre))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E006";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Segundo Nombre' es obligatorio para personas naturales.";
            }

            if (string.IsNullOrWhiteSpace(tramaPrimerApellido))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E007";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Primer Apellido' es obligatorio para personas naturales.";
            }

            if (string.IsNullOrWhiteSpace(tramaSegundoApellido))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E008";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Segundo Apellido' es obligatorio para personas naturales.";
            }
        }
        else if (tramaTipoPersona.ToUpper() == "J")
        {
            if (!string.IsNullOrWhiteSpace(tramaPrimerNombre))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E009";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Primer Nombre' debe estar vac칤o para personas jur칤dicas.";
            }

            if (!string.IsNullOrWhiteSpace(tramaSegundoNombre))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E010";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Segundo Nombre' debe estar vac칤o para personas jur칤dicas.";
            }

            if (!string.IsNullOrWhiteSpace(tramaPrimerApellido))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E011";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Primer Apellido' debe estar vac칤o para personas jur칤dicas.";
            }

            if (!string.IsNullOrWhiteSpace(tramaSegundoApellido))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E012";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Segundo Apellido' debe estar vac칤o para personas jur칤dicas.";
            }

            if (string.IsNullOrWhiteSpace(tramaRazonSocial))
            {
                dtErrores.Rows.Add(1);
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E013";
                dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Raz칩n Social' es obligatorio para personas jur칤dicas.";
            }
        }
        else
        {
            dtErrores.Rows.Add(1);
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E014";
            dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "El campo 'Tipo de Persona' debe ser 'N' (Natural) o 'J' (Jur칤dica).";
        }

        // Si hubo errores, devolverlos inmediatamente antes de continuar
        if (dtErrores.Rows.Count > 0)
        {
            return dtErrores;
        }

        // 游댳 FIN CAMBIO


        // 游댳 INICIO CAMBIO: Ajuste temporal para proveedor (caso de RazonSocial)
        if (copiarRazonSocialAPrimerNombre && tramaTipoPersona.ToUpper() == "J")
        {
            if (string.IsNullOrWhiteSpace(tramaPrimerNombre) && !string.IsNullOrWhiteSpace(tramaRazonSocial))
            {
                tramaPrimerNombre = tramaRazonSocial;
            }
        }
        // 游댳 FIN CAMBIO


        // 游댳 Aqu칤 contin칰a el flujo original del servicio
        // Ejemplo: construcci칩n de trama, env칤o al proveedor, manejo de respuesta, etc.
        // ...

    }
    catch (Exception ex)
    {
        dtErrores.Rows.Add(1);
        dtErrores.Rows[dtErrores.Rows.Count - 1]["Codigo"] = "E999";
        dtErrores.Rows[dtErrores.Rows.Count - 1]["Descripcion"] = "Error inesperado: " + ex.Message;
    }

    return dtErrores;
}
